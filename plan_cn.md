# Plan

## 概述与总览

多智能体协作解决问题时（由于不同智能体的输入输出存在一定因果关系），若存在恶意的智能体或个别在某个环节出错，在某个环节输出传播错误的信息，最终很有可能通过错误积累导致系统失败。

解决方法：分步随机审计，投票解决：具体说来：

1.  每个智能体拥有公私钥，每个智能体通过数字签名加密自己的消息。

2.  每个智能体随机审计一定数量的其他智能体的工作结果，通过加密的输入输出理性地判断被审计者的工作结果是否合理（输出为T/F)，（公私钥加密，确保消息正确）。（在一些关键的节点增加审计流程，并先用少量智能体进行审计，然后用若有异常则全体投票，同时审查时利用KV Cache技术，提高审计效率）

3.  若有不合理的结果则将请求整个智能体系统进行投票共识，将被审计者的输入输出信息传给其他智能体，通过投票来淘汰恶意智能体，然后将恶意智能体的工作重新分配给诚实智能体，完成任务。先用少量智能体进行审计若有问题再集体投票这样能够节省资源与效率。

## 异常智能体行为：

- 1类异常：恶意攻击：使得系统任务失败（或概率性错误可与恶意攻击归为一类，但是需要举例）

  - 攻击方式：根据上下文，恶意智能体输入或传播看似合理的指令，信息误导其他智能体。

  例如正常情况下根据上下文文本，智能体1,2,3的回答应该分别为：

  > 1：Vera Cruz，"Hush...Hush, Sweet Charlotte , Robert Aldrich， a cameo role as，Kiss Me Deadly
  >
  > 2：Robert Aldrich， Kiss Me Deadly
  >
  > 3：Robert Aldrich

  如果智能体1被恶意攻击，则会找寻文本zhong1类似的内容进行误导，通过链式传递，最终达到攻击目标。示例：

  > 1：Vera Cruz，"Hush...Hush, Sweet Charlotte , Robert Aldrich， a cameo role as，Kiss Me Deadly
  >
  > 2：Robert Aldrich， Kiss Me Deadly
  >
  > 3：Robert Aldrich

  攻击思想：用材料中的内容进行一定的误导，保证一定隐蔽性的同时，通过链式传递下去，最终达到攻击效果。

- 2类异常：恶意审计：作为审计智能体时恶意颠倒审计结果，使得系统通过恶意的共识结果或无意义地对正确结果进行投票共识。
- 3类异常：恶意投票，在需要全网共识时进行恶意投票，使误导整个系统对结果的判断，使得最终任务失败，或者影响系统的效率。

### 实验要求

分开实验，即：只存在1类异常智能体，只存在2类异常智能体，只存在3类异常智能体。

## 具体实现

基于当前在`src`下的代码在不同拓扑形势的智能体协作架构上（链式，网式，分散式，总分式等）进行实验（框架已有）。

### 修改

1. 在原框架结构上加入prompt，将部分执行任务的智能体改成恶意智能体。
2. 加入一个审计专家组用于审计。（或由其他智能体进行审计（稍微复杂））
3. 分开实验，即对下列三种恶意智能体分别进行实验：只存在1类异常智能体，只存在2类异常智能体，只存在3类异常智能体。

#### 具体审计流程：

1. 专门设计一个审计专家组，里面有若干个智能体。
2. 每一步子任务完成后，用随机数选定几个智能体，智能体将任务流程中的输入输出全部提供给审计组中的智能体。
3. 审计组的智能体仔细判断子任务的输入输出是否合理，并给出T/F的输出。
4. 若有不合理的结果则将请求整个智能体系统进行投票共识，将被审计者的输入输出信息传给其他智能体，通过投票来淘汰恶意智能体
5. 若审计结果出错，则将恶意智能体的工作重新分配给诚实智能体，完成任务。先用少量智能体进行审计若有问题再集体投票这样能够节省资源与效率。（可以不改变系统的拓扑结构，换一个正常prompt，让原智能体重新回答问题）。

#### 实验安排（先对链式智能体协作架构进行实验）：

（审计完成用安全智能体替代：即将原智能体的攻击prompt换成正常的prompt）

1. （6智能体1错误）无恶意智能体各个架构对任务的准确率。
2. 加入恶意智能体各个架构对任务的准确率。
3. 在有恶意智能体的存在下，加入防御机制各个架构对任务的准确率。（表格1）（画图：正常准确率，加入恶意后下降的准确率，再加入防御机制后回升的数据）
4. （6智能体1错误）原方法的各个中间智能体回答的准确性和加入防御机制以后各个中间智能体回答的准确性。（图1（5个子图））（画线：攻击者，正常者的准确率，加入防御机制后二者的准确率）进行8轮。
5. 10个智能体不同错误数量的智能体对无防御机制和有防御机制的平均准确性（0个，1个错误智能体，2个错误智能体），五个拓扑结构，3个数据集（表2）。
6. 采用不同模型：GPT3.5，GPT4o，deepseek-v3，千问（表格3）
   方法核心：通过随机审计，共识投票的方法在分布式的多智能体系统中实现安全与回答质量保证。
7. 原系统完成任务的时间，加入审计后完成任务的时间。（恶意状态与正常状态）做单个即可。
8. 不同拓扑结构下的审计成本的对比（时间）。
9. 恶意投票，恶意审计智能体下对系统的影响。
10. 在恶意审计恶意投票之下的效率（时间）。
    架构:由中心化系统统一随机调度分配，整合智能体工作，然后各个智能体分布式地进行分工工作。
